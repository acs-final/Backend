# Stage 1: Build
FROM openjdk:17-jdk-slim AS build
WORKDIR /app

# Gradle í”„ë¡œì íŠ¸ íŒŒì¼ ë³µì‚¬
COPY . .

# gradlew íŒŒì¼ì— ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬
RUN chmod +x gradlew

# ì˜ì¡´ì„± ë‹¤ìš´ë¡œë“œ ë° ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹Œë“œ
RUN ./gradlew :member:build --no-daemon -x test

# Stage 2: Runtime
FROM openjdk:17-jdk-slim
WORKDIR /app

# ğŸ”¥ íŠ¹ì • JAR íŒŒì¼ í•˜ë‚˜ë§Œ ë³µì‚¬
COPY --from=build /app/member/build/libs/member-service.jar /app/app.jar

# ì»¨í…Œì´ë„ˆ í¬íŠ¸ ì§€ì •
EXPOSE 8080

# JAR íŒŒì¼ ì‹¤í–‰
ENTRYPOINT ["java", "-jar", "/app/app.jar"]

